<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.comment">
	<select id="listComment" parameterType="String" resultType="articleReplyVo">
		SELECT
  	    		  A.*
			FROM    (
  	          SELECT	 LEVEL AS LVL
        	            , ARTICLE_NO
            	        , REPLY_NO
                	    , PARENT_NO
                    	, CONTENT
	                    , WRITE_MEMBER_ID
    	               
        	    FROM    ARTICLE_REPLY
            	START WITH
                	    PARENT_NO           = 0 
            	CONNECT BY
            	        PRIOR ARTICLE_NO    = PARENT_NO 
	            ORDER SIBLINGS BY
    	                ARTICLE_NO DESC
       			 ) A
       			 WHERE ARTICLE_NO in (
	       			 SELECT regexp_substr('10001, 10003, 10004, 10007', '[^,]+', 1, LEVEL)
					FROM DUAL
					CONNECT BY LEVEL &lt;= length(regexp_replace('10001, 10003, 10004, 10007', '[^,]+', '')) + 1
       			 )
		<!-- WHERE   rNum BETWEEN (#{pageNum}-1)*10+1   AND (#{pageNum}-1)*10+10  -->
	
	
	</select>
	
	<select id="listComment2" parameterType="String" resultType="articleReplyVo">
	SELECT
  	    		  A.*
			FROM    (
  	          SELECT	ROWNUM as rNum
    	                ,LEVEL AS LVL
        	            , ARTICLE_NO
            	        , REPLY_NO
                	    , PARENT_NO
                    	, CONTENT
	                    , WRITE_MEMBER_ID
    	               
        	    FROM    ARTICLE_REPLY
            	START WITH
                	    PARENT_NO           = 0 
            	CONNECT BY
            	        PRIOR ARTICLE_NO    = PARENT_NO 
	            ORDER SIBLINGS BY
    	                ARTICLE_NO DESC
       			 ) A
       			 WHERE ARTICLE_NO = #{articleNo}
	</select>
	
	<insert id="insertComment" parameterType="articleReplyVo">
		INSERT INTO ARTICLE_REPLY
		VALUES
		(
		 	 COMMENT_SEQ.NEXTVAL
		 	 ,#{articleNo}
			 ,#{parentNo}
			 ,#{content}
			 ,#{writeMemberId}
			 ,sysdate
		)
	
	</insert>
	
	
</mapper>
